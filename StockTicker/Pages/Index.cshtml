@page  
@using StockTicker.Models
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}


<!DOCTYPE html>
<html>

<h1 class="display-4 text-center"><u>Stock Ticker Game</u></h1>

<!--Show this at page start then after information is submitted save the data and hide this div-->
<div id="startArea" class="text-center" runat="server">
    <form method="post">
        <span>Please Enter a Stock Symbol To Begin Game:</span>

        <select id="stockSymbol" name="stockSymbol">
               <option value="AAPL">AAPL - (apple)</option>
               <option value="MSFT">MSFT - (microsoft)</option>
               <option value="AMZN">AMZN - (amazon)</option>
               <option value="TSLA">TSLA - (tesla)</option>
               <option value="GME">GME - (gamestop)</option>
        </select>
        
        <br />
        @Html.AntiForgeryToken()
        <input type="button" id="startButton" value="Start" onclick="toggleDiv('startArea')"/>

    </form>
</div>


<!--after above info is submitted and saved to DB unhide this div-->
<div id="gameArea" class="text-center" style="visibility:hidden" runat="server">

    <!--Show graph here-->
    <div id="graph">
    <center>
        <div id="tester" style="width:600px;height:250px;"></div>
    </center>
    </div><br/>

    <!--users bank account-->

        <table class="account-info">
            <tr>
                <th class="account-info">Bank Account:</th>
                <td class="account-info">$@Model.Balance</td>
            </tr>
            <tr>
                <th class="account-info">Owned Stock:</th>
                <td class="account-info">@Model.StockOwned</td>
            </tr>
        </table>
        <br/>
    
        <form id="menu" method="post">
            <!--buttons for buy or sell-->
            <div id="stockInfo"></div>
            <span>Would you like to Buy, Sell, Hold, or Quit?</span><br />
            <input asp-page-handler="Buy" type="radio" id="buyButton" name="bshbtn" value="Buy" onclick="showBuySellInput()">Buy</>
            <input asp-page-handler="Sell" type="radio" id="sellButton" name="bshbtn" value="Sell" onclick="showBuySellInput()" />Sell</>
            <input asp-page-handler="Hold" type="radio" id="holdButton" name="bshbtn" value="Hold" onclick="showBuySellInput()"/>Hold</><br />
            <input type="text" id="buySellInput" style="visibility:hidden" /><br /><br />
            <center>
            <div class="slidecontainer" id="slider" style="visibility:hidden">
                <input type="range" min="0" max="@Model.Balance" value="50" class="slider" id="myRange">
                <p>Amount: <span id="demo"></span></p>
            </div>
            </center>
            <!--quit button-->
            <input type="button" name="acceptButton" value="Accept" /><br /><br />
            <input type="button" name="quitButton" value="Quit" />
        </form>

</div>

</html>

@section Scripts
{

    <script src="https://cdn.plot.ly/plotly-2.12.1.min.js"></script>
    <script src="plotly-2.12.1.min.js"></script>

    <script>
        var data = [
            {
                x: ['Bank Account', 'Stocks'],
                y: [@Model.Balance, @Model.StockOwned],
                type: 'bar'
            }
        ];

        Plotly.newPlot('tester', data);
    </script>

    <script type="text/javascript">
        function showBuySellInput() {
            var hold = document.getElementById("holdButton");
            if (hold.checked) {
                document.getElementById("buySellInput").style.visibility = 'hidden';
                document.getElementById("slider").style.visibility = 'hidden';
            }
            else {
                document.getElementById("buySellInput").style.visibility = 'visible';
                document.getElementById("slider").style.visibility = 'visible';
            }
        }
    </script>
    
    <script type="text/javascript">

        //function to hide/show divs on start button click
        function toggleDiv(id) {
            var div = document.getElementById(id);
            div.style.display = "none";
            var div = document.getElementById('gameArea');
            div.style.visibility = "visible";

        };
    </script>
    
    <!--Ajax Scripts-->
    <script type="text/javascript">
        
        //initialize the game
        $("#startButton").click(function() {
            var e = document.getElementById("stockSymbol");
            var strUser = e.value;
            $.ajax({
                type: "POST",
                url: "/Index?handler=AjaxGameStart",
                data: { "val": strUser },
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function(message) {
                    
                    document.getElementById("stockInfo").innerHTML = message;
                }
            });
        });

        //function to handle accept button (buy/sell/hold)
        $("#acceptButton").click(function() {

            var button = $("input[type=radio][name=bshbtn]:checked").val();
            
            if(button == "Buy")//buy 
            {
                $.ajax({
                    type: "POST",
                    url: "/Index?handler=AjaxBuy",
                    data: { },
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: "json",
                    headers:
                    {
                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function(message) {
                    
                        
                    }
                });
            }
            else if(button == "Sell")//sell
            {
                $.ajax({
                    type: "POST",
                    url: "/Index?handler=AjaxSell",
                    data: {  },
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: "json",
                    headers:
                    {
                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function() {
                    
                        
                    }
                });
            }
            else if(button == "Hold")//hold 
            {
                $.ajax({
                    type: "POST",
                    url: "/Index?handler=AjaxHold",
                    data: {  },
                    contentType: 'application/x-www-form-urlencoded',
                    dataType: "json",
                    headers:
                    {
                        "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    },
                    success: function() {
                    
                        
                    }
                });
            }
            else { break; }
        });


        //function to quit game
        $("#quitButton").click(function() {
            $.ajax({
                type: "POST",
                url: "/Index?handler=AjaxQuit",
                data: {  },
                contentType: 'application/x-www-form-urlencoded',
                dataType: "json",
                headers:
                {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                },
                success: function() {
                    
                }
            });
        });
               
    </script>

    <script>
        
        var slider = document.getElementById("myRange");
        var output = document.getElementById("demo");
        output.innerHTML = slider.value;

        slider.oninput = function () {
            output.innerHTML = this.value;
        }
    </script>
}
